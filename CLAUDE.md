# Unity Project Guidelines - GatchaSpire

このドキュメントはUnityプロジェクト「GatchaSpire」の開発ガイドラインを定義します。以下の内容に従ってプロジェクトを進めてください。

## 最上位ルール

- 効率を最大化するため、**複数の独立したプロセスを実行する必要がある場合は、それらのツールを順次ではなく並行して呼び出す**
- **思考は英語で行う必要があります**。ただし、**日本語で回答する必要があります**

## プロジェクト情報

- **プロジェクト名**: GatchaSpire
- **Unity バージョン**: 2021.3.22f1
- **プラットフォーム**: PC（Windows）、モバイル対応予定
- **プロジェクト構造**:
  - **Assets/Scripts**: メインスクリプト
    - **Core**: 基盤システム（Character.cs, GoldManager.cs等）
    - **Gameplay**: ゲームプレイ関連
    - **UI**: UI関連
    - **Editor**: エディタ拡張
    - **Utils**: ユーティリティ
  - **Assets/Resources**: データアセット（統一管理）
    - **Settings**: 設定ファイル（DevelopmentSettings.asset）
    - **Characters**: キャラクターデータ（レアリティ別）
    - **Gacha**: ガチャシステムデータ
    - **Audio**: 音声設定
  - **Assets/Prefab**: プレハブ（システムコンポーネント）
  - **Assets/Scenes**: シーン
    - **Main**: メインシーン
    - **Title**: タイトルシーン
    - **Development**: 開発用シーン
    - **Tests**: テスト用シーン
  - **Assets/Fonts**: フォント素材
  - **Assets/Tests**: テストアセット

## Unity開発ルール

### コーディング規約
- **C#スクリプト**のコメントとドキュメントは**日本語**で記述する
- **XMLドキュメントコメント**（///）は日本語で記述する
- **コード内のコメント**（//）は日本語で記述する
- **絵文字は使用しない**
- 日本語記述時は不要なスペースを含めない
  - 例: ◯「Unity開発ガイド」× "Unity 開発 ガイド"

### Unity固有のルール
- **MonoBehaviourの継承**：必要な場合のみ使用し、パフォーマンスを考慮する
- **SerializeField**：publicフィールドの代わりに適切に使用する
- **プレハブの管理**：Prefabsフォルダで適切に整理する
- **シーン管理**：Scenesフォルダで目的別に整理する
- **アセット管理**：各フォルダで種類別に適切に整理する

### パフォーマンス規約
- **Update()メソッド**：重い処理は避け、必要に応じてコルーチンやイベント駆動に変更
- **オブジェクトプーリング**：頻繁に生成/削除されるオブジェクトには適用を検討
- **テクスチャサイズ**：適切な解像度とフォーマットを選択
- **メモリ管理**：不要なアセットは適切にUnloadする

### ファイル命名規約
- **Csharpスクリプト**: PascalCase（例：PlayerController.cs）
- **プレハブ**: PascalCase（例：PlayerCharacter.prefab）
- **シーン**: PascalCase（例：MainMenu.scene）
- **アート素材**: snake_case（例：character_idle.png）
- **音声素材**: snake_case（例：bgm_battle.wav）

## プロジェクト目標

### 開発スタイル
- **各タスクの要件と設計は`.tmp/design.md`で文書化する必要があります**
- **各メインタスクの詳細なサブタスクは`.tmp/task.md`で定義する必要があります**
- **作業の進捗に応じて`.tmp/task.md`を更新する必要があります**

1. まず計画を作成し、要件を`.tmp/design.md`に文書化する
2. 要件に基づいて、必要なすべてのタスクを特定し、`.tmp/task.md`のMarkdownファイルにリストアップする
3. 計画が確立されたら、新しいブランチを作成して作業を開始する
   - ブランチ名は`feature/`で始まり、タスクの簡潔な要約を含める
4. タスクを単一のコミット内で完了できる小さく管理可能な単位に分割する
5. 各タスクのチェックリストを作成して進捗を管理する
6. 可読性を維持するため、常にコードフォーマッターを適用する
7. 変更をコミットしない。代わりに確認を求める
8. プルリクエスト（PR）の作成を指示された場合、以下の形式を使用する：
   - **タイトル**: タスクの簡潔な要約
   - **主な変更点**: 変更内容、注意点等を記述
   - **テスト**: どのテストに合格したか、どのテストを追加したか、テストの実行方法を明確に記載
   - **関連タスク**: 関連タスクのリンクまたは番号を提供
   - **その他**: その他の特別な注意事項や関連情報

## Unity開発のプログラミングルール

- 絶対に必要でない限り、値をハードコーディングしない
- **ScriptableObject**を使用してゲームデータを管理する
- **Singletonパターン**の過度な使用を避ける
- **nullチェック**を適切に行い、NullReferenceExceptionを防ぐ
- **コルーチン**の適切な停止処理を実装する
- **イベントシステム**を活用してコンポーネント間の結合を緩める

### オブジェクト初期化規約

- **単純なコレクション型**は宣言時に初期化してNullReferenceExceptionを防ぐ
  - `List<T>`, `Dictionary<TKey, TValue>`, `HashSet<T>`, `Queue<T>`, `Stack<T>`等
  - 例：`private List<string> items = new List<string>();`
- **複雑な依存関係を持つオブジェクト**はメソッド内で制御された初期化を行う
  - Unity固有オブジェクト（`GameObject`, `Component`等）
  - 外部依存のあるマネージャークラス
  - 設定に依存する初期化が必要なオブジェクト
  - インターフェース型のフィールド
- **理由**：単純なコレクションのnullエラーは予防可能だが、複雑なオブジェクトは適切な初期化タイミングとエラーハンドリングが重要

## Unity固有のタスク完了通知

- タスク完了時は必ず通知を送信する
- 「タスク完了」とは、ユーザーに回答を終了し、次の入力を待っている状態を指す
- フォーマット修正、リファクタリング、ドキュメント更新などの**軽微なタスクでも通知が必要**
- 以下の形式と`powershell.exe`を使用して通知を送信：
  - `powershell.exe -File 'C:\Users\tomot\Scripts\Notify-Toast.ps1' -message "${TASK_DESCRIPTION} completed!"'`
  - `${TASK_DESCRIPTION}`はタスクの要約である必要があります

## Unityツール使用ガイドライン

- **Context7 MCP**を使用して最新のUnity APIと機能について情報を取得する
- 隠しフォルダ（`.tmp`等）の検索には**Bashツール**を使用する
- **Unity MCPツール**を活用してUnityエディタと直接連携する
- コンソールログの確認とデバッグにUnity MCPの機能を使用する

## プロジェクト特有の注意事項

- **GatchaSpire**は「ガチャ」をテーマにしたゲームプロジェクトと推測されます
- キャラクター管理、ガチャシステム、UI/UX設計に重点を置く
- モバイル対応を考慮したパフォーマンス最適化を心がける
- ユーザーデータの適切な管理とセーブシステムの実装を検討する

---

*このドキュメントはプロジェクトの進行に応じて適宜更新されます。*
