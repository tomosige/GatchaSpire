# GatchaSpire 実装タスクリスト（修正版）

## 実装方針
- **タスク駆動開発**: 小さなタスクを段階的に完了
- **チェックボックス管理**: 進捗を明確に可視化
- **柔軟な実装**: 具体的なコードは実装時に決定
- **品質保証**: 各タスクに検証項目を含める

---

## Phase 0: Unity基盤とエラーハンドリング

### 目標
Unity特化の基盤システムとエラーハンドリングを確立

### Step 0.1: プロジェクト構造セットアップ
- [x] Unity特化ディレクトリ構造を作成
- [x] Assembly Definition ファイルを設定
- [x] Script Execution Order を適切に設定
- [x] Player Settings の最適化
- [x] 名前空間の統一ルールを決定

### Step 0.2: 共通インターフェース実装
- [x] `IUnityGameSystem` インターフェースを作成
- [x] `IValidatable` インターフェースを作成
- [x] `IEditorPreviewable` インターフェースを作成
- [x] `IUnityResettable` インターフェースを作成
- [x] `IApplicationLifecycle` インターフェースを作成
- [x] `ValidationResult` クラスを実装
- [x] インターフェースのコンパイル確認

### Step 0.3: エラーハンドリングシステム
- [x] `SystemError` クラスを実装
- [x] `ErrorSeverity` と `ErrorCategory` 列挙型を定義
- [x] `IErrorHandler` インターフェースを作成
- [x] `IErrorReporter` インターフェースを作成
- [x] `UnityErrorHandler` クラスを実装
- [x] Unity ログメッセージの自動捕捉機能
- [x] エラー履歴の記録・管理機能
- [x] ファイル保存機能の実装
- [x] 復旧アクション登録システム
- [x] エラーハンドリングの動作テスト

### Step 0.4: Unity特化システム管理
- [x] `UnityGameSystemCoordinator` クラスを実装
- [x] システム登録・初期化機能
- [x] 依存関係解決の基本実装
- [x] Unity ライフサイクルとの連携
- [x] DontDestroyOnLoad による永続化
- [x] 致命的エラー時の安全なリセット
- [x] システム健康状態の監視
- [x] デバッグ用 OnGUI 表示機能

### Step 0.5: 開発設定システム
- [x] `DevelopmentSettings` ScriptableObject を作成
- [x] 設定項目の定義（デバッグ、パフォーマンス、バランス、チート）
- [x] 設定のバリデーション機能
- [ ] カスタムインスペクターの実装
- [ ] クイックアクション機能
- [x] 設定の動的適用機能
- [x] Resources フォルダでの管理

### Step 0.6: 基盤テスト
- [x] Phase0_UnityFoundationTest シーンを作成
- [x] 基盤テストスクリプトを実装
- [x] システム初期化の自動テスト
- [x] エラーハンドリングの動作確認
- [x] 開発設定の適用テスト
- [x] Unity 統合機能のテスト
- [x] パフォーマンス基準の確認
- [x] 全テストの成功確認

### Step 0.7: Phase 0 完了検証
- [x] 全コンポーネントのエラーなし初期化
- [x] Unity エディタでの安定動作
- [x] ビルド後の動作確認
- [x] メモリリークの発生確認
- [x] エラーハンドリングの網羅性確認
- [x] ドキュメントの更新

---

## Phase 1: コアシステム

### 目標
基本的なリソース管理システムの構築

### Step 1.1: Unity特化ゴールドシステム
- [x] `GoldManager` クラスの実装
  - [x] IUnityGameSystem インターフェース実装
  - [x] IUnityResettable インターフェース実装
  - [x] IApplicationLifecycle インターフェース実装
  - [x] エラーハンドリング統合
  - [x] 開発設定との連携
  - [x] イベントシステムの実装
  - [x] 永続化機能の実装
- [x] `GoldCalculator` の実装
  - [x] 戦闘報酬計算ロジック
  - [x] ガチャコスト計算ロジック
  - [x] アップグレードコスト計算
  - [x] 売却価格計算
  - [x] 開発設定倍率の適用
  - [x] エラーハンドリングとフォールバック
  - [x] パフォーマンステスト実装
- [x] `GoldTransactionHistory` の実装
  - [x] 取引記録システム
  - [x] リアルタイム分析機能
  - [x] ファイル永続化
  - [x] 統計情報生成
  - [x] パフォーマンス最適化
- [x] ゴールドシステムテスト
  - [x] 基本操作テスト
  - [x] エラー条件テスト
  - [x] パフォーマンステスト
  - [x] 永続化テスト
  - [x] 統合テスト

### Step 1.2: キャラクター基本システム
- [x] `CharacterData` ScriptableObject の実装
  - [x] 基本パラメータ定義
  - [x] バリデーション機能
  - [x] エディタプレビュー機能
- [x] `CharacterStats` 構造体の実装
  - [x] 基本ステータス管理
  - [x] 修正値適用システム
  - [x] 計算メソッド群
- [x] `Character` クラスの実装
  - [x] CharacterData からの初期化
  - [x] レベルアップシステム
  - [x] ステータス計算
  - [x] エラーハンドリング
- [x] `CharacterDatabase` クラスの実装
  - [x] データ読み込みシステム
  - [x] 検索・フィルタ機能
  - [x] データ整合性チェック
- [x] 列挙型の定義
  - [x] CharacterRarity
  - [x] CharacterRace  
  - [x] CharacterClass
- [x] キャラクターシステムテスト
  - [x] データ読み込みテスト
  - [x] ステータス計算テスト
  - [x] 検索機能テスト
  - [x] エラーハンドリングテスト

### Step 1.3: ガチャシステム統合版
- [x] `GachaSystemManager` クラスの実装
  - [x] 基本ガチャ機能
  - [x] ガチャアップグレード機能
  - [x] ゴールドシステム連携
  - [x] エラーハンドリング
  - [x] 開発設定との連携
- [x] `GachaSystemData` ScriptableObject の実装
  - [x] 排出率設定
  - [x] アップグレード効果設定
  - [x] バリデーション機能
- [x] ガチャ結果・履歴クラスの実装
  - [x] `GachaResult` クラス
  - [x] `GachaHistory` クラス
  - [x] ファイル永続化
- [x] レアリティ計算システム
  - [x] 基本排出率計算
  - [x] レベル補正計算
  - [x] 重み付き抽選
- [x] ガチャシステムテスト
  - [x] 基本ガチャテスト
  - [x] アップグレードテスト
  - [x] 排出率検証テスト
  - [x] 統合テスト

### Step 1.4: システム統合テスト
- [x] Phase1_CoreSystemTest シーンを作成
- [x] システム間連携テスト
  - [x] ゴールド→ガチャの流れ
  - [x] ガチャ→キャラクター獲得の流れ
  - [x] エラー時の整合性保証
- [x] パフォーマンステスト
  - [x] 大量操作時の安定性
  - [x] メモリ使用量測定
  - [x] フレームレート影響測定
- [x] エラーシナリオテスト
  - [x] 各システムの異常時動作
  - [x] 復旧処理の確認
  - [x] データ整合性の保証

### Step 1.5: Phase 1 完了検証
- [x] 全機能の動作確認
- [x] エラーハンドリングの完全性
- [x] パフォーマンス基準の達成
- [x] メモリリークの非存在確認
- [x] ドキュメントの更新
- [x] 次フェーズへの準備完了

---

## Phase 2: ゲームロジック

### 目標
キャラクター操作と戦闘システムの構築

### Step 2.1: キャラクターインベントリ統合版
- [x] `CharacterInventoryManager` クラスの実装
  - [x] 統合キャラクター管理
  - [x] 売却機能
  - [x] 合成機能
  - [x] 経験値化機能
  - [x] 操作競合防止
- [x] 操作データクラスの実装
  - [x] `CharacterOperation` クラス
  - [x] `CharacterOperationResult` クラス
  - [x] `CharacterAvailabilityChecker` クラス
- [x] インベントリテスト
  - [x] 各操作の単体テスト
  - [x] 競合状態テスト
  - [x] エラーハンドリングテスト

### Step 2.2: ボードシステム分割版
- [x] `BoardStateManager` クラスの実装
  - [x] 7x8 戦闘フィールド状態管理（自軍7x4、敵軍7x4）
  - [x] TFT方式UI表示対応（配置時7x4、戦闘時7x8）
  - [x] キャラクター配置・移動・除去
  - [x] 状態変更通知
- [ ] `PlacementValidator` クラスの実装
  - [ ] 配置ルール検証
  - [ ] エラーメッセージ生成
  - [ ] 動的ルール追加対応
- [ ] `PlacementOptimizer` クラスの実装
  - [ ] 基本的な配置提案
  - [ ] 位置スコア計算
  - [ ] 最適化戦略切り替え
- [ ] ボードシステムテスト
  - [ ] 配置操作テスト
  - [ ] 検証ルールテスト
  - [ ] 最適化機能テスト

### Step 2.3: スキルシステム詳細版
- [ ] レベル制スキル習得システム
  - [ ] Lv3/6/10での段階的スキル習得
  - [ ] 合成レベルジャンプ対応（複数レベル上昇時の習得保証）
  - [ ] `SkillUnlockResult`による習得結果管理
- [ ] 個別クールダウン管理システム
  - [ ] Time.timeベースの正確な時間管理
  - [ ] 各スキル独立したクールタイム
  - [ ] 端末性能非依存の動作保証
- [ ] 複雑なSkillEffect継承システム
  - [ ] `DamageEffect`, `HealEffect`, `StatModifierEffect`等
  - [ ] スタッキング・重複効果管理
  - [ ] 状態異常・位置操作効果
  - [ ] スケーリング・クリティカル計算
- [ ] スキルシステム統合テスト
  - [ ] レベルアップ・習得テスト
  - [ ] クールダウン精度テスト
  - [ ] 複雑効果適用テスト
  - [ ] バトルシステム統合テスト

### Step 2.4: シナジーシステム分割版
- [ ] `SynergyCalculator` クラスの実装
  - [ ] シナジー計算ロジック
  - [ ] 種族・クラス判定
  - [ ] レベル計算
- [ ] `SynergyEffectApplier` クラスの実装
  - [ ] 効果適用処理
  - [ ] 効果除去処理
  - [ ] 重複管理
- [ ] `SynergyVisualizer` クラスの実装
  - [ ] 基本表示機能
  - [ ] ハイライト機能
  - [ ] プレビュー機能
- [ ] `SynergySystemManager` による統合
- [ ] シナジーシステムテスト
  - [ ] 計算精度テスト
  - [ ] 効果適用テスト
  - [ ] 表示機能テスト

### Step 2.5: バトルマネージャー統合版
- [ ] `BattleManager` クラスの実装
  - [ ] リアルタイム戦闘フロー制御（Time.deltaTime使用、0.1秒固定間隔）
  - [ ] TFT方式移動システム（射程内に敵なし→1マス接近）
  - [ ] 段階的ダメージ増加（30秒後から時間切れ防止）
  - [ ] 7x8戦闘フィールド管理
  - [ ] 殲滅戦勝利条件判定
- [ ] 戦闘データクラスの実装
  - [ ] `BattleSetup` クラス
  - [ ] `BattleResult` クラス
  - [ ] `BattleStatistics` クラス
- [ ] AI システムとの連携
  - [ ] `BattleAI` クラス実装
  - [ ] 行動決定ロジック
  - [ ] 戦術的判断
- [ ] バトルシステムテスト
  - [ ] 基本戦闘テスト
  - [ ] AI 行動テスト
  - [ ] システム統合テスト

### Step 2.6: Phase 2 統合テスト
- [ ] 全システム連携テスト
- [ ] 実際のゲームフロー確認
- [ ] パフォーマンス最終確認
- [ ] エラーハンドリング網羅確認

---

## Phase 3-5: 簡略化タスク構成

### Phase 3: UI統合
- [ ] UI基盤システム実装
- [ ] ガチャUI実装
- [ ] パーティ編成UI実装
- [ ] 戦闘UI実装
- [ ] UI統合テスト

### Phase 4: 拡張機能
- [ ] 天井システム実装
- [ ] ピックアップガチャ実装
- [ ] 配置最適化強化
- [ ] 特殊アイテムシステム実装

### Phase 5: 最終統合
- [ ] ゲームサイクル管理実装
- [ ] データリセット機能実装
- [ ] 最終統合テスト
- [ ] パフォーマンス最適化
- [ ] リリース準備

---

## タスク管理のガイドライン

### タスクの粒度
- **小タスク**: 30-60分で完了可能
- **中タスク**: 2-4時間で完了可能
- **大タスク**: 1日で完了可能

### 進捗管理
- [ ] 各タスク完了時にチェック
- [ ] 問題発生時は詳細を記録
- [ ] 定期的な進捗レビュー実施

### 品質保証
- [ ] 各Step完了時にテスト実行
- [ ] エラーハンドリングの確認
- [ ] パフォーマンス基準の達成確認
- [ ] コードレビューの実施

### 依存関係の管理
- [ ] 前提条件の完了確認
- [ ] ブロッカーの早期解決
- [ ] 代替案の準備

この形式により、実装の柔軟性を保ちながら確実な進捗管理が可能になります。